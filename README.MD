ä¼ é€é—¨æ•™ç¨‹ï¼šhttps://miyogurt.github.io/nodelover-books/#/koa-todo-api/æ­å»ºé¡¹ç›®å¼€å‘çŽ¯å¢ƒ

æºç åœ°å€ï¼šhttps://github.com/MiYogurt/todo-api

---

**1 æ–°å»ºé¡¹ç›®**ï¼š`$ mkdir todo && cd todo && npm init -y && git init`

**2 å®‰è£… Typescript çŽ¯å¢ƒ**ï¼š`$ npm i -g typescript && tsc --init`

**3 å®‰è£…ä¾èµ–é¡¹**ï¼š`$ npm i koa -S && npm i @types/koa @types/node -D`

**4 é…ç½®tsconfig.json**ï¼šé…ç½®è¾“å‡ºæ–‡ä»¶å¤¹ï¼Œä¸”ä½¿å…¶æ”¯æŒ async/await ç‰¹æ€§ã€‚

```JavaScript
{
    "compilerOptions": {
        "module": "commonjs",
        "target": "es5",
        "noImplicitAny": false,
        "sourceMap": false,
        "outDir": "dist",
        "lib": [
            "es6",
            "es7"
        ]
    }
}
```

**5 åˆ›å»º src/index.ts ï¼š**

```Typescript
import * as Koa from 'koa';

const app = new Koa();

app.use(async ctx => {
    ctx.body = "Todo App";
});

app.listen(3000, () => {
    console.log("Server Stared on http://localhost:3000")
})
```

ç”±äºŽä½¿ç”¨äº† **Typescript** ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ **Node.js** ä¸­ä½¿ç”¨ `es6 modules` è§„èŒƒäº†ã€‚

âœ… æˆ‘ä»¬å…ˆåœ¨å‘½ä»¤è¡Œé‡Œé¢è¾“å…¥ï¼š `$ tsc` 

ç„¶åŽä¼šå¯¹æ‰€æœ‰.tsæ–‡ä»¶è¿›è¡Œç¼–è¯‘ã€‚å½“ç¼–è¯‘å®Œæˆä¹‹åŽï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸€ä¸ª dist æ–‡ä»¶å¤¹ã€‚


**6 package.json å¢žåŠ  start è„šæœ¬**

```bash
"start": "node dist/index.js"
```

å†åœ¨å‘½ä»¤è¡Œé‡Œé¢è¿è¡Œï¼š`npm start`

**7 éƒ¨ç½² node æœåŠ¡å™¨çš„ç¥žå™¨ï¼š pm2**ï¼š`$ npm i -g pm2`

éš¾é“æ¯æ¬¡å†™å®Œä»£ç æˆ‘éƒ½éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Ÿ

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ pm2 è¿™ä¸ªå·¥å…·ï¼Œè¿™æ˜¯ä¸€ä¸ªéƒ¨ç½² node æœåŠ¡å™¨çš„ç¥žå™¨ï¼Œèƒ½å¤Ÿå®žçŽ°è‡ªåŠ¨é‡å¯ã€‚

âœ… åœ¨ package.json é‡Œé¢æ·»åŠ ä¸€äº›è„šæœ¬ï¼š

```JavaScript
"scripts": {
    "tsc": "tsc --watch",
    "start": "pm2 start dist/index.js --watch dist"
},
```

âš ï¸ æ­¤æ—¶æˆ‘ä»¬éœ€è¦å¯åŠ¨ä¿©ä¸ªæŽ§åˆ¶å°ï¼šå…ˆè¿è¡Œ tsc å‘½ä»¤ï¼Œå†è¿è¡Œ startã€‚

```JavaScript
$ npm run tsc

/* æ–°å»ºå¦ä¸€ä¸ªçª—å£ */

$ npm run start
```

## å®‰è£…æ’ä»¶

ðŸš€ æ‰€æœ‰ koa æ’ä»¶éƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼šhttps://github.com/koajs/koa/wiki

**8 å®‰è£… body è§£æžæ’ä»¶ï¼š** `$ npm install koa-better-body -S`

**9 å®‰è£…è·¯ç”±æ’ä»¶ï¼š** `$ npm install koa-better-router -S`

âš ï¸ ç”±äºŽä½¿ç”¨çš„æ˜¯ `koa@3.x` çš„ `better` ç³»åˆ—æ’ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ `koa-convert` è¿™ä¸ªå·¥å…·ã€‚

```bash
$ npm i koa-convert -S
```

ðŸ“ ä¿®æ”¹æˆ‘ä»¬çš„ `index.ts`

```JavaScript
import * as Koa from 'koa';
import * as bodyParser from 'koa-better-body';
import * as Router from 'koa-better-router';
import * as Convert from 'koa-convert';

const router = Router().loadMethods();

const app = new Koa();

router.get('/hello', async (ctx, next) => {
  ctx.body = `Hello world! Prefix: ${ctx.route.prefix}`
  await next()
});

router.get('/foobar', async (ctx, next) => {
  ctx.body = `Foo Bar Baz! ${ctx.route.prefix}`
  await next()
})

const api = Router({ prefix: '/api' })
api.extend(router)

app.use(Convert(bodyParser()));
app.use(router.middleware());
app.use(api.middleware());

app.listen(3000, () => {
    console.log("Server Stared on http://localhost:3000")
});
```